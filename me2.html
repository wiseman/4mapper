<html>
<head>
<link href="main.css" rel="stylesheet" type="text/css" />
<style>
body { background:#333; padding:20px; }
#header { margin:0 auto 10px auto; width:90%; background:#ff9; border:1px solid #000; }
#header #nav { float:right; padding:3px 10px; }
#header h1 { padding:3px 10px 0px 10px; margin:0; }
#header p { padding:0px 10px 3px 10px; margin:0; }
#footer { margin:0 auto; width:90%; border:1px solid #000; border-top:none; }
#footer p a { color:#333; }
#footer p { padding:5px 10px; margin:4px 0; background:#999; margin:0; }
</style>

<title>Where have I been? &ndash; 6/20/2008 to 7/9/2008</title>
<script type="text/javascript" src="http://maps.google.com/maps?file=api&v=2.x&key=ABQIAAAAy-QtcaLYn_SCweZpooQCBxSTTlokCSxydBno61tyPns6rnnU6BTMGJ_UfQQvmk9p6rsUJp6Cf436Ug"></script>
<!-- <script type="text/javascript" language="javascript" src="js/twitter_users.json"></script> -->
<script type="text/javascript" language="javascript" src="raphael-min.js"></script>
<script type="text/javascript" language="javascript" src="history10k.js"></script>
<script type="text/javascript" language="javascript" src="fire-eagle.js"></script>
<script type="text/javascript" language="javascript" src="cartographer.min.0.2jjw.js"></script>
<script type="text/javascript"
        src="http://ajax.googleapis.com/ajax/libs/dojo/1.3.2/dojo/dojo.xd.js"
        djConfig="isDebug:false">
</script>
<script language="javascript">

var cartographer; 

function load() {
  if( GBrowserIsCompatible() ) {
    var map = new GMap2(document.getElementById("map"));
    map.setCenter(new GLatLng(18, 0), 2);
    map.addControl(new GLargeMapControl());
    map.addMapType(G_PHYSICAL_MAP);
    console.log('hello1');

    gridsize = 5
    start = (new Date).getTime();
    for (i = 0; i < 3000; i++) {
      var ki = parseInt( 180.0 / parseFloat( gridsize ) );
      var kj = parseInt( 360.0 / parseFloat( gridsize ) );
    }
    console.log('time', start - (new Date).getTime());

//    checkins = compute_checkins();
    checkins = compute_fe();
    console.log('cartographer', Cartographer);
    console.log('cartographer_t', typeof(Cartographer));
    cartographer = Cartographer( map, { colorize:"#000", colorizeAlpha:.5 } );
    console.log('hello2');
    cartographer.cluster( checkins, { gridColor: "#c00", enableGrid: false, color:"#fff", colorHover:"#fff",stroke:"#fff", popup:"reduce", popupLabel:"<b>Number of checkins</b><br>"  } );
    console.log('hello3');
    map.setCenter(centroid(checkins), Math.max(map.getZoom(),2));
  }
}

function compute_checkins() {
  data = new Array(g_history['checkins'].length);
  for (i = 0; i < data.length; i++) {
    venue = g_history['checkins'][i]['venue']
    lng = venue['geolong'];
    lat = venue['geolat'];
    data[i] = {lat: lat, lng: lng, val: 1, label: '<a href="http://playfoursquare.com/venue/' + venue['id'] + '">' + venue['name'] + '</a>'};
  }
  return data;
}

function compute_fe() {
  data = new Array(g_fe_history.length);
  for (i = 0; i < data.length; i++) {
    point = g_fe_history[i]['georss_point']
    lat = point[0];
    lng = point[1];
    data[i] = {lat: lat, lng: lng, val: 1, label: g_fe_history[i]['name']};
  }
  return data;
}

function centroid(data) {
  lat_sum = 0.0;
  lng_sum = 0.0;
  for (i = 0; i < data.length; i++) {
    lat_sum += data.lat;
    lng_sum += data.lng;
  }
  return GLatLng(lat_sum / data.length, lng_sum / data.length);
}



</script>
</head>
<body onload="load()" onunload="GUnload()">
<div id="header">
<div id="nav">By <a href="http://twitter.com/lemonodor">John Wiseman</a></div>
<h1>Where have I been? &ndash; 6/20/2008 to 7/9/2008</h1>
<p><small><i>(Zoom in for greater detail.)</i></small></p>
</div>
<div id="map" style="margin:0 auto; width:90%;height:80%;max-height:600px; border:1px solid #000;"></div>
<div id="footer">
</div>

</body>
</html>
